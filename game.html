<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blokz Reflex - Gameplay</title>
<style>
  body {
    margin: 0; 
    background: #111;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }
  #game {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: linear-gradient(135deg, #222, #444);
  }
  .block {
    position: absolute;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 0 10px #0af;
    transition: transform 0.15s ease;
  }
  #score, #lives, #trophies {
    position: fixed;
    top: 15px;
    font-weight: bold;
    font-size: 18px;
    padding: 6px 12px;
    border-radius: 10px;
    background: rgba(0,0,0,0.5);
    box-shadow: 0 0 10px #0af;
    user-select: none;
  }
  #score { right: 15px; }
  #lives { right: 130px; }
  #trophies { right: 260px; }
  #message {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 22px;
    font-weight: bold;
    color: #0af;
    user-select: none;
  }
  #btnShop {
    position: fixed;
    top: 15px;
    left: 15px;
    background: #0af;
    border: none;
    padding: 10px 14px;
    border-radius: 8px;
    font-weight: bold;
    z-index: 1100;
    box-shadow: 0 0 6px #0af;
    cursor: pointer;
  }
  #shopPanel {
    display: none;
    position: fixed;
    top: 60px;
    left: 15px;
    width: 320px;
    max-height: 400px;
    overflow-y: auto;
    background: rgba(20,20,30,0.95);
    border-radius: 12px;
    padding: 15px;
    z-index: 1200;
    box-shadow: 0 0 15px #0af;
    color: white;
  }
  #shopPanel h3 {
    margin-top: 0;
    text-align: center;
    margin-bottom: 10px;
  }
  .shop-item {
    margin-bottom: 12px;
    border-bottom: 1px solid #0af;
    padding-bottom: 8px;
  }
  .shop-item strong {
    font-size: 16px;
  }
  .shop-item p {
    font-size: 13px;
    margin: 5px 0;
  }
  .shop-item button {
    margin-top: 4px;
    padding: 6px 10px;
    background: #0af;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    color: white;
  }
  .shop-item button:disabled {
    background: #444;
    cursor: default;
  }
</style>
</head>
<body>

<div id="game"></div>

<!-- Infos scores/vies/troph√©es -->
<div id="score">Score: 0</div>
<div id="lives">Vies: 3</div>
<div id="trophies">Troph√©es: 0</div>
<div id="message"></div>

<!-- Bouton Boutique -->
<button id="btnShop" title="Ouvrir la boutique">üè™ Boutique</button>

<!-- Panneau Boutique -->
<div id="shopPanel">
  <h3>Boutique üõí</h3>
  <div id="shopItems"></div>
  <button id="btnCloseShop">Fermer</button>
</div>

<script>
(() => {
  const gameEl = document.getElementById('game');
  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const trophiesEl = document.getElementById('trophies');
  const messageEl = document.getElementById('message');
  const btnShop = document.getElementById('btnShop');
  const shopPanel = document.getElementById('shopPanel');
  const btnCloseShop = document.getElementById('btnCloseShop');
  
  // Param√®tres du jeu
  const gameWidth = window.innerWidth;
  const gameHeight = window.innerHeight;
  const blockSize = 80;
  const blockDisappearTime = 3000; // en ms (3s)
  const maxLives = 3;
  
  // Variables du jeu
  let score = 0;
  let lives = maxLives;
  let trophies = parseInt(localStorage.getItem('blokzTrophies')) || 0;
  
  let shopData = JSON.parse(localStorage.getItem('blokzShopData')) || {
    multiplier: 1,
    extraLives: 0,
    specialBlocks: {
      explosive: false,
      frozen: false,
      bomb: false,
    },
  };
  
  let gameRunning = false;
  let blockTimer = null;
  
  function saveTrophies() {
    localStorage.setItem('blokzTrophies', trophies.toString());
  }
  function saveShopData() {
    localStorage.setItem('blokzShopData', JSON.stringify(shopData));
  }
  
  // Mise √† jour affichage scores/vies/troph√©es
  function updateDisplays() {
    scoreEl.textContent = `Score: ${score}`;
    livesEl.textContent = `Vies: ${lives}`;
    trophiesEl.textContent = `Troph√©es: ${trophies}`;
  }
  
  // Fin de partie
  function gameOver() {
    gameRunning = false;
    clearInterval(blockTimer);
    messageEl.textContent = "Game Over! Clique sur la page pour rejouer.";
  }
  
  // Perdre une vie
  function loseLife() {
    lives--;
    updateDisplays();
    if(lives <= 0) {
      gameOver();
    }
  }
  
  // Cr√©e un bloc avec un type al√©atoire
  function spawnBlock() {
    if(!gameRunning) return;
    
    // Types de blocs possibles
    const typesPossible = ['normal', 'gray']; // gris
    if(shopData.specialBlocks.explosive) typesPossible.push('explosive');
    if(shopData.specialBlocks.frozen) typesPossible.push('frozen');
    if(shopData.specialBlocks.bomb) typesPossible.push('bomb');
    
    // On ajoute des blocs normaux color√©s toujours
    typesPossible.push('color');
    
    // Choix al√©atoire du type
    const type = typesPossible[Math.floor(Math.random() * typesPossible.length)];
    
    const block = document.createElement('div');
    block.classList.add('block');
    block.style.width = block.style.height = blockSize + 'px';
    block.style.left = Math.random() * (gameWidth - blockSize) + 'px';
    block.style.top = Math.random() * (gameHeight - blockSize) + 'px';
    block.style.transform = 'scale(1)';
    
    // Style selon type
    switch(type) {
      case 'gray':
        block.style.backgroundColor = '#888'; // gris = mort instantan√©e
        break;
      case 'explosive':
        block.style.backgroundColor = 'orange';
        break;
      case 'frozen':
        block.style.backgroundColor = 'cyan';
        break;
      case 'bomb':
        block.style.backgroundColor = 'red';
        break;
      case 'color':
        block.style.backgroundColor = 'limegreen';
        break;
      default:
        block.style.backgroundColor = 'purple';
    }
    
    // Click sur bloc
    block.onclick = (e) => {
      e.stopPropagation();
      clearTimeout(disappearTimeout);
      
      if(type === 'gray') {
        // Mort instantan√©e
        lives = 0;
        updateDisplays();
        messageEl.textContent = "Bloc gris cliqu√© ! Game Over.";
        gameOver();
        return;
      }
      
      // Calcul des points gagn√©s
      let pointsGained = 1;
      if(type === 'explosive' && shopData.specialBlocks.explosive) pointsGained = 3;
      else if(type === 'frozen' && shopData.specialBlocks.frozen) pointsGained = 2;
      else if(type === 'bomb' && shopData.specialBlocks.bomb) pointsGained = 5;
      
      score += pointsGained;
      trophies += pointsGained * shopData.multiplier;
      
      updateDisplays();
      
      messageEl.textContent = `Bien jou√© ! +${pointsGained} point${pointsGained>1?'s':''}`;
      
      // Animation disparition
      block.style.transform = 'scale(0)';
      setTimeout(() => {
        if(gameEl.contains(block)) gameEl.removeChild(block);
      }, 150);
    };
    
    // Disparition automatique
    const disappearTimeout = setTimeout(() => {
      if(gameEl.contains(block)) {
        gameEl.removeChild(block);
        if(type !== 'gray') {
          // Perdre une vie si bloc color√© non cliqu√©
          loseLife();
          messageEl.textContent = "Tu as rat√© un bloc ! -1 vie";
        }
      }
    }, blockDisappearTime);
    
    gameEl.appendChild(block);
  }
  
  // D√©marrer la partie
  function startGame() {
    score = 0;
    lives = maxLives + shopData.extraLives;
    trophies = trophies; // charg√©s du localStorage
    
    updateDisplays();
    messageEl.textContent = "Jeu d√©marr√© ! Clique sur les blocs color√©s.";
    gameRunning = true;
    
    // Faire spawn un bloc toutes les 1.2 secondes (ajuste si besoin)
    if(blockTimer) clearInterval(blockTimer);
    blockTimer = setInterval(spawnBlock, 1200);
  }
  
  // Gestion bouton boutique
  btnShop.onclick = () => {
    updateShopItems();
    shopPanel.style.display = 'block';
  };
  btnCloseShop.onclick = () => {
    shopPanel.style.display = 'none';
  };
  
  // Mise √† jour de la boutique
  function updateShopItems() {
    const shopItemsEl = document.getElementById('shopItems');
    shopItemsEl.innerHTML = '';
    
    const items = [
      {
        id: 'multiplier2',
        name: 'Multiplicateur √ó2',
        description: 'Double tes troph√©es gagn√©s.',
        price: 20,
        bought: shopData.multiplier >= 2,
        buyFunc: () => {
          if(trophies >= 20 && shopData.multiplier < 2) {
            trophies -= 20;
            shopData.multiplier = 2;
            saveTrophies();
            saveShopData();
            updateShopItems();
            updateDisplays();
          }
        }
      },
      {
        id: 'multiplier3',
        name: 'Multiplicateur √ó3',
        description: 'Triple tes troph√©es gagn√©s.',
        price: 50,
        bought: shopData.multiplier >= 3,
        buyFunc: () => {
          if(trophies >= 50 && shopData.multiplier < 3) {
            trophies -= 50;
            shopData.multiplier = 3;
            saveTrophies();
            saveShopData();
            updateShopItems();
            updateDisplays();
          }
        }
      },
      {
        id: 'extraLife',
        name: 'Vie suppl√©mentaire',
        description: 'Ajoute une vie pour la partie en cours.',
        price: 15,
        bought: false,
        buyFunc: () => {
          if(trophies >= 15) {
            trophies -= 15;
            shopData.extraLives++;
            lives++;
            updateDisplays();
            saveTrophies();
            saveShopData();
            updateShopItems();
          }
        }
      },
      {
        id: 'explosiveBlock',
        name: 'Bloc Explosif',
        description: 'Active le bloc explosif (3 points).',
        price: 30,
        bought: shopData.specialBlocks.explosive,
        buyFunc: () => {
          if(trophies >= 30 && !shopData.specialBlocks.explosive) {
            trophies -= 30;
            shopData.specialBlocks.explosive = true;
            saveTrophies();
            saveShopData();
            updateShopItems();
            updateDisplays();
          }
        }
      },
      // Tu peux rajouter d'autres blocs sp√©ciaux ici comme frozen, bomb...
    ];
    
    for(const item of items) {
      const itemEl = document.createElement('div');
      itemEl.className = 'shop-item';
      
      const nameEl = document.createElement('strong');
      nameEl.textContent = item.name;
      itemEl.appendChild(nameEl);
      
      const descEl = document.createElement('p');
      descEl.textContent = item.description;
      itemEl.appendChild(descEl);
      
      const priceEl = document.createElement('span');
      priceEl.textContent = `Prix : ${item.price} troph√©es`;
      itemEl.appendChild(priceEl);
      
      const btnBuy = document.createElement('button');
      btnBuy.textContent = item.bought ? 'D√©j√† achet√©' : 'Acheter';
      btnBuy.disabled = item.bought || trophies < item.price;
      btnBuy.onclick = () => {
        if(!btnBuy.disabled) {
          item.buyFunc();
        }
      };
      itemEl.appendChild(btnBuy);
      
      shopItemsEl.appendChild(itemEl);
    }
  }
  
  // Relancer le jeu au clic sur la page apr√®s game over
  document.body.onclick = () => {
    if(!gameRunning) {
      startGame();
    }
  };
  
  // Initialisation
  updateDisplays();
  messageEl.textContent = "Clique pour commencer !";
})();
</script>

</body>
</html>

