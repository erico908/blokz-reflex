<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Blokz Reflex</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background: linear-gradient(to bottom right, #1f1f1f, #000); color: white; overflow: hidden; }

    .page { display: none; padding: 2rem; text-align: center; height: 100vh; }
    .active { display: flex; flex-direction: column; justify-content: center; align-items: center; }

    h1 { font-size: 3rem; color: #00ffc8; }

    .btn {
      margin: 1rem;
      padding: 1rem 2rem;
      font-size: 1.2rem;
      background: #00ffc8;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    .btn:hover { background: #00ccaa; }

    #gameArea {
      width: 90vw;
      max-width: 800px;
      height: 70vh;
      border: 2px solid #00ffc8;
      margin: auto;
      position: relative;
      background: #111;
      border-radius: 20px;
      overflow: hidden;
    }

    .block {
      width: 60px;
      height: 60px;
      position: absolute;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
    }

    .gray { background: gray; }
    .red { background: #ff4d4d; }
    .blue { background: #4d94ff; }
    .green { background: #4dff88; }
    .yellow { background: #ffff4d; }

    .hud {
      display: flex;
      justify-content: space-between;
      width: 90%;
      margin: 1rem auto;
      font-size: 1.2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .topbar {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }

    .link-btn {
      margin-left: 1rem;
      background: transparent;
      border: 1px solid #00ffc8;
      color: #00ffc8;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
    }

    #countdown {
      font-size: 5rem;
      font-weight: bold;
      margin-top: 2rem;
      height: 6rem;
      line-height: 6rem;
    }
  </style>
</head>
<body>
  <!-- ACCUEIL -->
  <div id="home" class="page active">
    <h1>Blokz Reflex</h1>
    <p>🎯 Clique sur les blocs colorés pour gagner des 🏆.</p>
    <p>❌ Évite les blocs gris. Rater un bloc coloré = -1 ❤️</p>
    <p>💾 Trophées et améliorations sont sauvegardés automatiquement.</p>
    <button class="btn" onclick="chooseDifficulty('easy')">Facile</button>
    <button class="btn" onclick="chooseDifficulty('medium')">Moyen</button>
    <button class="btn" onclick="chooseDifficulty('impossible')">Impossible</button>
    <button class="btn" onclick="showPage('localGame')">Mode Local</button>
    <div class="topbar">
      <button class="link-btn" onclick="showPage('shop')">🏪 Boutique</button>
      <button class="link-btn" onclick="showPage('profile')">👤 Profil</button>
    </div>
  </div>

  <!-- ÉCRAN PRÊT -->
  <div id="ready" class="page">
    <h1>Tu es prêt ?</h1>
    <p>Le jeu commence dès que tu appuies sur <strong>Commencer</strong>.</p>
    <button class="btn" onclick="startGame()">Commencer</button>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

  <!-- JEU -->
  <div id="game" class="page">
    <div class="hud">
      <div>❤️ Vies : <span id="lives"></span></div>
      <div>🏆 Trophées : <span id="trophies"></span></div>
      <div>🔥 Multiplicateur : x<span id="multiplier"></span></div>
      <div>📈 Score : <span id="score"></span></div>
    </div>
    <div id="countdown"></div>
    <div id="gameArea"></div>
    <div class="topbar">
      <button class="link-btn" onclick="endGame('Tu as quitté la partie')">🏠 Quitter</button>
    </div>
  </div>

  <!-- BOUTIQUE -->
  <div id="shop" class="page">
    <h1>Boutique 🛒</h1>
    <div class="store-item">
      <h3>❤️ Vie Supplémentaire — 50 🏆</h3>
      <button onclick="buyLife()">Acheter</button>
    </div>
    <div class="store-item">
      <h3>🔥 Multiplicateur x<span id="shopMultiplier"></span> → x<span id="nextMultiplier"></span> — <span id="multiplierCost"></span> 🏆</h3>
      <button onclick="upgradeMultiplier()">Améliorer</button>
    </div>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

  <!-- PROFIL -->
  <div id="profile" class="page">
    <h1>Profil 👤</h1>
    <p>🏆 Trophées : <span id="profileTrophies"></span></p>
    <p>❤️ Vies : <span id="profileLives"></span></p>
    <p>🔥 Multiplicateur : x<span id="profileMultiplier"></span></p>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

  <!-- MODE LOCAL -->
  <div id="localGame" class="page">
    <h1>Mode Multijoueur Local</h1>
    <p>Partage ton écran avec un ami pour jouer ensemble !</p>
    <button class="btn" onclick="showPage('home')">Retour</button>
  </div>

<script>
  const pages = ["home", "ready", "game", "shop", "profile", "localGame"];
  const colors = ['red', 'blue', 'green', 'yellow'];
  const difficulties = { easy: 3000, medium: 1500, impossible: 800 };
  let gameTimer = null;
  let selectedDifficulty = "easy";
  let trophies = parseInt(localStorage.getItem("trophies") || "0");
  let lives = parseInt(localStorage.getItem("lives") || "3");
  let multiplier = parseInt(localStorage.getItem("multiplier") || "1");
  let score = 0;

  function showPage(id) {
    pages.forEach(p => {
      document.getElementById(p).classList.remove("active");
    });
    document.getElementById(id).classList.add("active");
    if (id === 'profile') updateProfile();
    if (id === 'shop') updateShop();
    if (id === 'game') updateUI();
  }

  function chooseDifficulty(diff) {
    selectedDifficulty = diff;
    showPage('ready');
  }

  function updateUI() {
    document.getElementById("lives").textContent = lives;
    document.getElementById("trophies").textContent = trophies;
    document.getElementById("multiplier").textContent = multiplier;
    document.getElementById("score").textContent = score;
  }

  // Fonction pour générer une position aléatoire dans le gameArea
  function randomPosition() {
    const gameArea = document.getElementById("gameArea");
    const maxWidth = gameArea.clientWidth - 60;  // taille du bloc
    const maxHeight = gameArea.clientHeight - 60;
    const x = Math.floor(Math.random() * maxWidth);
    const y = Math.floor(Math.random() * maxHeight);
    return { x, y };
  }

  function spawnBlock(speed) {
    const gameArea = document.getElementById("gameArea");
    gameArea.innerHTML = ""; // supprime l'ancien bloc

    const block = document.createElement("div");
    const isGray = Math.random() < 0.2;
    block.className = "block " + (isGray ? "gray" : colors[Math.floor(Math.random() * colors.length)]);

    const pos = randomPosition();
    block.style.left = pos.x + "px";
    block.style.top = pos.y + "px";

    block.onclick = () => {
      if (isGray) return endGame("Tu as cliqué sur un bloc gris, partie terminée !");
      score += multiplier;
      trophies++;
      updateUI();
      clearTimeout(gameTimer);
      gameTimer = setTimeout(() => spawnBlock(speed), speed);
    };

    gameArea.appendChild(block);

    // Timer pour la disparition du bloc
    gameTimer = setTimeout(() => {
      // Si bloc toujours là (pas cliqué)
      if (!block.parentNode) return;
      if (!isGray) {
        lives--;
        updateUI();
        if (lives <= 0) return endGame("Tu as perdu toutes tes vies !");
      }
      spawnBlock(speed);
    }, speed);
  }

  function startGame() {
    score = 0;
    updateUI();
    showPage('game');
    let count = 3;
    const countdown = document.getElementById("countdown");
    countdown.textContent = count;
    const interval = setInterval(() => {
      count--;
      if (count > 0) countdown.textContent = count;
      else {
        clearInterval(interval);
        countdown.textContent = "";
        spawnBlock(difficulties[selectedDifficulty]);
      }
    }, 1000);
  }

  function endGame(message) {
    alert(message + `\nScore final : ${score}\nTrophées gagnés : ${trophies}`);
    localStorage.setItem("trophies", trophies);
    localStorage.setItem("lives", lives);
    localStorage.setItem("multiplier", multiplier);
    showPage('home');
  }

  function updateProfile() {
    document.getElementById("profileTrophies").textContent = trophies;
    document.getElementById("profileLives").textContent = lives;
    document.getElementById("profileMultiplier").textContent = multiplier;
  }

  function updateShop() {
    document.getElementById("shopMultiplier").textContent = multiplier;
    document.getElementById("nextMultiplier").textContent = multiplier + 1;
    document.getElementById("multiplierCost").textContent = multiplier * 100;
  }

  function buyLife() {
    if (trophies >= 50) {
      trophies -= 50;
      lives++;
      updateUI();
      updateShop();
      alert("Vie achetée !");
    } else {
      alert("Pas assez de trophées !");
    }
  }

  function upgradeMultiplier() {
    const cost = multiplier * 100;
    if (trophies >= cost) {
      trophies -= cost;
      multiplier++;
      updateUI();
      updateShop();
      alert("Multiplicateur amélioré !");
    } else {
      alert("Pas assez de trophées !");
    }
  }
</script>
</body>
</html>
















